(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c526d12"],{"30ca":function(e,t){var i=[{key:"title",label:"餐點"},{key:"number",label:"數量"},{key:"sum",label:"小計"}];e.exports={fields:i}},"6b41":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("b-form",{staticClass:"mb-4",attrs:{inline:""}},[i("label",{staticClass:"mr-sm-2"},[e._v("表單")]),i("b-form-select",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{options:e.displayForm.options,size:"lg"},on:{change:e.selectForm},model:{value:e.displayForm.init.sheetTitle,callback:function(t){e.$set(e.displayForm.init,"sheetTitle",t)},expression:"displayForm.init.sheetTitle"}}),i("b-button",{staticClass:"mx-2",attrs:{pressed:e.showBy.list,size:"lg",variant:"primary"},on:{"update:pressed":function(t){return e.$set(e.showBy,"list",t)},click:function(t){e.showBy.card=!1}}},[i("b-icon",{attrs:{icon:"card-list","aria-label":"List"}})],1),i("b-button",{attrs:{pressed:e.showBy.card,size:"lg",variant:"primary"},on:{"update:pressed":function(t){return e.$set(e.showBy,"card",t)},click:function(t){e.showBy.list=!1}}},[i("b-icon",{attrs:{icon:"columns","aria-label":"columns"}})],1)],1),i("b-tabs",{attrs:{pills:"",card:""}},[e._l(e.viewList,(function(t){return e._l(t.tabs,(function(r){return i("b-tab",{key:t.time+r.key,attrs:{title:r.label+"("+e.orders[t.time][r.key].length+")"}},[i("div",[e._v("共 "),i("span",[e._v(e._s(e.orders[t.time][r.key].length))]),e._v(" 筆")]),e.showBy.card?i("div",{staticClass:"card-columns"},e._l(e.orders.ori,(function(n,s){return i("transition",{key:"order"+s,attrs:{"leave-active-class":"animate__animated "+(n.is_take?"animate__rotateOutUpLeft":"animate__rotateOutUpRight")}},[n.time==t.time&&n.is_take==r.is_take?i("CCard",{staticClass:"my-4"},[i("CCardHeader",{staticClass:"d-flex align-items-center"},[i("h5",[e._v("訂單編號")]),i("h3",[e._v(e._s(n.no))]),i("CSwitch",{staticClass:"mx-1 float-right",attrs:{size:"sm",color:"warning",variant:"3d",checked:n.is_take},on:{"update:checked":[function(t){return e.$set(n,"is_take",t)},function(t){return e.switchTakeStatus(n)}]}}),i("small",[e._v(e._s(n.order_time)),i("br"),e._v(e._s(n.name)+"("+e._s(n.phone)+")"),i("br"),e._v(e._s(n.take_time))]),i("CButton",{staticClass:"position-absolute",staticStyle:{right:"10px"},attrs:{color:"secondary"},on:{click:function(t){return e.editOrder(s)}}},[e._v(" 編輯 ")])],1),i("CCardBody",[i("CDataTable",{attrs:{border:"",items:n.parseDetail,fields:e.fields}}),i("div",[e._v("備註：")]),i("h3",{domProps:{innerHTML:e._s(e.noteTohtml(n.note))}}),i("div",{staticClass:"p-3 bg-warning text-white text-center"},[e._v("總計 "),i("span",[e._v(e._s(n.count))]),e._v(" 樣菜 / 共 "),i("span",[e._v("$"+e._s(n.sum))])])],1)],1):e._e()],1)})),1):e._e(),e.showBy.list?i("div",[i("CDataTable",{attrs:{border:"",items:e.orders[t.time][r.key],fields:e.list_fields}})],1):e._e()])}))}))],2),i("CModal",{attrs:{title:"編輯訂單",show:e.editModal,color:"warning",size:"lg",closeOnBackdrop:!1},on:{"update:show":function(t){e.editModal=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[i("CButton",{attrs:{color:"danger"},on:{click:e.editCancel}},[e._v("返回")]),i("CButton",{attrs:{color:"success"},on:{click:e.editConfirm}},[e._v("送出")])]},proxy:!0}])},[i("CSelect",{attrs:{value:e.editingOrder.order_time_format,label:"取餐時間：",options:e.orderTime,size:"lg",horizontal:""},on:{"update:value":function(t){return e.$set(e.editingOrder,"order_time_format",t)}}}),i("CInput",{attrs:{label:"姓名：",placeholder:"取餐人姓名",size:"lg"},model:{value:e.editingOrder.name,callback:function(t){e.$set(e.editingOrder,"name",t)},expression:"editingOrder.name"}}),i("CInput",{attrs:{label:"電話：",placeholder:"取餐人電話",size:"lg"},model:{value:e.editingOrder.phone,callback:function(t){e.$set(e.editingOrder,"phone",t)},expression:"editingOrder.phone"}}),i("hr"),i("CDataTable",{attrs:{border:"",items:e.editingOrder.detail,fields:e.fields},scopedSlots:e._u([{key:"number",fn:function(t){var r=t.item;return[i("td",[i("b-form-spinbutton",{attrs:{id:"sb-inline",size:"lg",min:"-5",max:"10",inline:"",variant:"warning"},model:{value:r.number,callback:function(t){e.$set(r,"number",t)},expression:"item.number"}})],1)]}},{key:"sum",fn:function(t){var r=t.item;return[i("td",[e._v(" "+e._s(e.getItemSum(r))+" ")])]}}])}),i("CInput",{attrs:{label:"其他金額",placeholder:"其他金額",horizontal:"",size:"lg"},model:{value:e.editingOrder.justifyPrice,callback:function(t){e.$set(e.editingOrder,"justifyPrice",t)},expression:"editingOrder.justifyPrice"}}),i("div",{staticClass:"p-2 mb-2 bg-warning text-white text-center"},[e._v("總計 "),i("span",[e._v(e._s(e.getOrderCount(e.editingOrder.detail)))]),e._v(" 樣菜 / 共 "),i("span",[e._v("$"+e._s(e.getOrderSum(e.editingOrder)))])]),i("hr"),i("CTextarea",{attrs:{label:"備註",size:"lg"},model:{value:e.editingOrder.note,callback:function(t){e.$set(e.editingOrder,"note",t)},expression:"editingOrder.note"}})],1),i("Loading",{attrs:{isLoading:e.isLoading}})],1)},n=[],s=i("c1df"),a=i.n(s),o=i("45d6"),l=i("cc0c"),d=i("31ac"),u=i("75b7"),c=i("30ca");i("77ed");function m(e,t,i,r,n,s,a){try{var o=e[s](a),l=o.value}catch(d){return void i(d)}o.done?t(l):Promise.resolve(l).then(r,n)}function h(e){return function(){var t=this,i=arguments;return new Promise((function(r,n){var s=e.apply(t,i);function a(e){m(s,r,n,a,o,"next",e)}function o(e){m(s,r,n,a,o,"throw",e)}a(void 0)}))}}var p=[{key:"name",label:"名字"},{key:"phone",label:"電話"},{key:"order_time",label:"時間"},{key:"sum",label:"小計"}],f={name:"ShowOrders",data:function(){return{isLoading:!0,adminDoc:null,formListSheet:null,formListRows:null,displayForm:{init:{},list:[],options:[]},interval:null,fields:c["fields"],list_fields:p,orders:{ori:[],noon:{is_take:[],not_take:[]},night:{is_take:[],not_take:[]}},viewList:[{time:"noon",label:"上午",tabs:[{label:"午未取",key:"not_take",is_take:!1},{label:"午已取",key:"is_take",is_take:!0}]},{time:"night",label:"上午",tabs:[{label:"晚未取",key:"not_take",is_take:!1},{label:"晚已取",key:"is_take",is_take:!0}]}],showBy:{card:!0,list:!1},count:{is_take:0,not_take:0},editModal:!1,editingOrder:{key:null,name:null,phone:null,order_time:null,order_time_format:null,note:null,detail:null,count:0,sum:0,justifyPrice:0},orderTime:null,itemList:{rows:[],byKey:{}},menu:[]}},components:{Loading:o["a"]},created:function(){a.a.locale("zh-tw"),this.accessSpreadSheet(),this.autoUpdate()},methods:{accessSpreadSheet:function(){var e=this;return h(regeneratorRuntime.mark((function t(){var i,r,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(d["getSettingDoc"])();case 2:return e.adminDoc=t.sent,e.formListSheet=e.adminDoc.sheetsByTitle["表單列表"],t.next=6,e.formListSheet.getRows();case 6:return e.formListRows=t.sent,i=e.adminDoc.sheetsByTitle["品項"],t.next=10,i.getRows();case 10:for(r=t.sent,n=0;n<r.length;n++)s=r[n],s.id&&(e.itemList.rows.push(s),e.itemList.byKey[s.id]=s);e.init(),e.selectForm();case 14:case"end":return t.stop()}}),t)})))()},init:function(){var e=this;return h(regeneratorRuntime.mark((function t(){var i,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.displayForm.list=[],e.displayForm.options=[],i=e.formListRows.length-1;case 3:if(!(i>=0)){t.next=18;break}if(r=e.formListRows[i],r.order_time=JSON.parse(r.order_time),r.groups=JSON.parse(r.groups),e.displayForm.list.push(r),e.displayForm.options.push({text:r.title,value:r.sheetTitle}),null!=e.displayForm.init.sheetTitle){t.next=15;break}if(!a()().isAfter(r.start_time)||!a()().isBefore(r.end_time)){t.next=15;break}return e.displayForm.init=r,t.next=14,Object(l["getMenu"])(e.adminDoc,e.displayForm.init.groups,!0);case 14:e.menu=t.sent;case 15:i--,t.next=3;break;case 18:case"end":return t.stop()}}),t)})))()},selectForm:function(){var e=this;return h(regeneratorRuntime.mark((function t(){var i,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isLoading=!0,null!=e.displayForm.init.sheetTitle){t.next=6;break}return e.displayForm.init=e.formListRows[e.formListRows.length-1],t.next=5,Object(l["getMenu"])(e.adminDoc,e.displayForm.init.groups,!0);case 5:e.menu=t.sent;case 6:return e.orderTime=e.displayForm.init.order_time,t.next=9,Object(u["getOrderDoc"])();case 9:return i=t.sent,r=i.sheetsByTitle[e.displayForm.init.sheetTitle],t.next=13,r.getRows();case 13:n=t.sent,e.orders.ori=n,e.setOrdersData(),e.isLoading=!1;case 17:case"end":return t.stop()}}),t)})))()},setOrdersData:function(){var e=this.orders.ori;this.orders.noon={is_take:[],not_take:[]},this.orders.night={is_take:[],not_take:[]};for(var t=0;t<e.length;t++){var i=e[t],r=i.order_time,n=a()(r).format("HH:mm");i.parseDetail=JSON.parse(i.detail),i.no=t+1,a()("2000-01-01 "+n).isBefore("2000-01-01 14:00")?(i.time="noon",""==i.take_time?(this.orders.noon.not_take.push(i),i.is_take=!1):(this.orders.noon.is_take.push(i),i.is_take=!0)):(i.time="night",""==i.take_time?(this.orders.night.not_take.push(i),i.is_take=!1):(this.orders.night.is_take.push(i),i.is_take=!0))}},autoUpdate:function(){var e=this;this.interval=setInterval((function(){e.selectForm(),console.log(a()().format()+" loading complete")}),6e4)},stopUpdate:function(){clearInterval(this.interval)},switchTakeStatus:function(e){var t=this;return h(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return t.isLoading=!0,e.is_take?(e.take_time=a()().format(),e.is_take=!0):(e.take_time="",e.is_take=!1),t.setOrdersData(),i.next=5,e.save({raw:!0});case 5:t.isLoading=!1;case 6:case"end":return i.stop()}}),i)})))()},getItemSum:function(e){return e.sum=e.price*e.number},getOrderData:function(e,t,i){for(var r=0;r<e.parseDetail.length;r++){var n=e.parseDetail[r];if(n.key==i.key)return n}return null},getOrderCount:function(e){var t=0;if(null!=e)for(var i=0;i<e.length;i++){var r=e[i];t+=r.number}return t},getOrderSum:function(e){var t=0;if(null!=e.detail)for(var i=0;i<e.detail.length;i++){var r=e.detail[i];t+=r.number*r.price}return t+=1*e.justifyPrice,t},noteTohtml:function(e){return e.replaceAll("\n","<br>")},editOrder:function(e){var t=this.orders[e];this.editingOrder.order_time_format=a()(t.order_time).format("HH:mm"),this.editingOrder.key=e,this.editingOrder.name=t.name,this.editingOrder.phone=t.phone,this.editingOrder.order_time=t.order_time,this.editingOrder.note=t.note.replaceAll("<br>","\n");for(var i=[],r=0;r<this.menu.length;r++)for(var n=this.menu[r],s=0;s<n.items.length;s++){var o=n.items[s],l=0,d=0,u=this.getOrderData(t,n,o);null!=u&&(l=u.number,d=u.sum),i.push({key:o.key,title:o.title,price:o.price,number:l,sum:d})}this.editingOrder.detail=i,this.editingOrder.count=t.count,this.editingOrder.sum=t.sum,this.editingOrder.justifyPrice=t.justifyPrice?t.justifyPrice:0,this.editModal=!0,this.stopUpdate()},editCancel:function(){this.autoUpdate(),this.editModal=!1},editConfirm:function(){var e=h(regeneratorRuntime.mark((function e(){var t,i,r,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t=this.editingOrder.key,i=this.orders.ori[t],i.name=this.editingOrder.name,i.phone=this.editingOrder.phone,i.order_time=a()(this.editingOrder.order_time).format("YYYY/MM/DD")+" "+this.editingOrder.order_time_format,i.note=this.editingOrder.note,r=[],n=0;n<this.editingOrder.detail.length;n++)s=this.editingOrder.detail[n],s.sum>0&&r.push(s);return i.detail=JSON.stringify(r),i.parseDetail=r,i.count=this.getOrderCount(r),i.sum=this.getOrderSum(this.editingOrder),i.justifyPrice=this.editingOrder.justifyPrice,e.next=15,i.save({raw:!0});case 15:this.editModal=!1,this.autoUpdate();case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},g=f,_=i("2877"),v=Object(_["a"])(g,r,n,!1,null,null,null);t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-7c526d12.cae33f90.js.map