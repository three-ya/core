(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3bcc9217"],{2427:function(e,t){function r(e){return e.match(/[-\w]{25,}/)}e.exports={getFileId:r}},cc0c:function(e,t,r){function n(e,t,r,n,i,a,s){try{var o=e[a](s),l=o.value}catch(u){return void r(u)}o.done?t(l):Promise.resolve(l).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var s=e.apply(t,r);function o(e){n(s,i,a,o,l,"next",e)}function l(e){n(s,i,a,o,l,"throw",e)}o(void 0)}))}}var a=r("2427"),s=a.getFileId,o=r("d55f"),l=o.ItemList;function u(e,t){return c.apply(this,arguments)}function c(){return c=i(regeneratorRuntime.mark((function e(t,r){var n,i,a,o,u,c=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]&&c[2],i=[],e.next=4,l(t);case 4:for(o in a=e.sent,r)Object.hasOwnProperty.call(r,o)&&(u=r[o],(n||u.show)&&function(){var e=null,t=[],r=[];if(u.sets)for(var o in e="set",u.sets)if(Object.hasOwnProperty.call(u.sets,o)){var l=u.sets[o];(n||l.show)&&function(){var e=[];if(l.items.forEach((function(t){var r=a.byKey[t];e.push({key:t,name:r.name})})),t.push({key:l.key,title:l.title,price:l.price,number:0,subItems:e}),null!=l.imgUrl){var n=s(l.imgUrl);r.push(n)}}()}u.items&&(e="single",u.items.forEach((function(e){if(n||e.show){var i=a.byKey[e.key];if(t.push({key:e.key,title:i.name,price:e.price,number:0}),e.showImg&&null!=i.url){var o=s(i.url);r.push(o)}}}))),i.push({type:e,title:u.title,items:t,images:r})}());return e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}e.exports={getMenu:u}},d55f:function(e,t){function r(e,t,r,n,i,a,s){try{var o=e[a](s),l=o.value}catch(u){return void r(u)}o.done?t(l):Promise.resolve(l).then(n,i)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var s=e.apply(t,n);function o(e){r(s,i,a,o,l,"next",e)}function l(e){r(s,i,a,o,l,"throw",e)}o(void 0)}))}}function i(e){return a.apply(this,arguments)}function a(){return a=n(regeneratorRuntime.mark((function e(t){var r,n,i,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={rows:[],byKey:{}},n=t.sheetsByTitle["品項"],e.next=4,n.getRows();case 4:for(i=e.sent,a=0;a<i.length;a++)s=i[a],s.id&&(r.rows.push(s),r.byKey[s.id]=s);return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}e.exports={ItemList:i}},f86d:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("CContainer",[r("CCard",{staticClass:"my-4"},[r("CCardHeader",[r("h1",[e._v(e._s(e.sheetSettings.title))]),r("p",{domProps:{innerHTML:e._s(e.sheetSettings.describe)}})])],1),r("CCard",{staticClass:"my-4",attrs:{id:"order-info"}},[r("CCardHeader",[r("h4",[e._v("訂購人資訊")])]),r("CCardBody",[r("CRow",[r("CCol",{attrs:{sm:"12"}},[r("CInput",{attrs:{label:"姓名(必填)",placeholder:"取餐人姓名","invalid-feedback":"請填入姓名","is-valid":e.name.validator(e.name),size:"lg"},model:{value:e.name.value,callback:function(t){e.$set(e.name,"value",t)},expression:"name.value"}})],1)],1),r("CRow",[r("CCol",{attrs:{sm:"12"}},[r("CInput",{attrs:{type:"number",label:"電話(必填)",placeholder:"09XX-XXXXXX","invalid-feedback":"請填入電話","is-valid":e.phone.validator(e.phone),size:"lg"},model:{value:e.phone.value,callback:function(t){e.$set(e.phone,"value",t)},expression:"phone.value"}})],1)],1),r("CRow",[r("CCol",{attrs:{sm:"4"}},[r("CSelect",{attrs:{value:e.orderTime.value,label:"訂購時間(必填)",options:e.orderTime.options,"invalid-feedback":"請選擇時間","is-valid":e.orderTime.validator(e.orderTime),size:"lg"},on:{"update:value":function(t){return e.$set(e.orderTime,"value",t)}}})],1)],1)],1)],1),e._l(e.menu,(function(t,n){return r("CCard",{key:"menu"+n,staticClass:"my-4"},[r("CCardHeader",{staticClass:"d-flex align-items-center"},[r("h4",[e._v(e._s(t.title))])]),e._l(t.images,(function(e,t){return r("CCardBody",{key:"img"+t,staticClass:"border-bottom"},[r("CCol",{attrs:{lg:"6"}},[r("CImg",{attrs:{src:"https://drive.google.com/uc?export=view&id="+e,width:"100%"}})],1)],1)})),e._l(t.items,(function(t,n){return r("CCardBody",{key:"item"+n,staticClass:"border-bottom"},[r("b-row",[r("b-col",{staticClass:"d-flex align-items-center"},[r("h4",[e._v(e._s(t.title))]),r("h3",{staticClass:"ml-2"},[r("CBadge",{attrs:{shape:"pill",color:"success"}},[e._v("$"+e._s(t.price))])],1)]),r("b-col",{staticClass:"d-flex justify-content-end"},[r("b-form-spinbutton",{attrs:{id:"sb-inline",size:"lg",min:"0",max:"10",inline:"",variant:"warning"},model:{value:t.number,callback:function(r){e.$set(t,"number",r)},expression:"item.number"}})],1)],1)],1)}))],2)})),r("CCard",{staticClass:"my-4"},[r("CCardHeader",[r("h4",[e._v("訂單備註")])]),r("CCardBody",[r("CTextarea",{attrs:{placeholder:"請寫下備註",size:"lg"},model:{value:e.note.value,callback:function(t){e.$set(e.note,"value",t)},expression:"note.value"}})],1)],1),r("CButton",{staticClass:"my-1",attrs:{size:"lg",color:"warning",block:""},on:{click:e.showOrderDetail}},[e._v(" 送出訂單 ")])],2),r("CModal",{attrs:{title:"確認訂單",show:e.comfirmModal,color:"warning",size:"sm",closeOnBackdrop:!1},on:{"update:show":function(t){e.comfirmModal=t}},scopedSlots:e._u([{key:"footer",fn:function(){return[r("CButton",{attrs:{color:"danger"},on:{click:function(t){e.comfirmModal=!1}}},[e._v("返回")]),r("CButton",{attrs:{color:"success"},on:{click:e.send}},[e._v("送出")])]},proxy:!0}])},[r("div",[e._v("取餐時間："),r("span",[e._v(e._s(e.orderTime.display))])]),r("div",[e._v("訂購姓名："+e._s(e.name.value))]),r("div",[e._v("聯絡電話："+e._s(e.phone.value))]),r("hr"),r("CDataTable",{attrs:{border:"",items:e.orderDetail.data,fields:e.fields}}),r("div",{staticClass:"p-2 mb-2 bg-warning text-white text-center"},[e._v("總計 "),r("span",[e._v(e._s(e.orderDetail.count))]),e._v(" 樣菜 / 共 "),r("span",[e._v("$"+e._s(e.orderDetail.sumPrice))])]),r("hr"),r("div",[e._v("備註：")]),r("h3",{domProps:{innerHTML:e._s(e.note.display)}})],1),r("Loading",{attrs:{isLoading:e.isLoading}})],1)},i=[],a=r("c1df"),s=r.n(a),o=r("45d6"),l=r("cc0c"),u=r("31ac"),c=r("75b7");function d(e,t,r,n,i,a,s){try{var o=e[a](s),l=o.value}catch(u){return void r(u)}o.done?t(l):Promise.resolve(l).then(n,i)}function m(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function s(e){d(a,n,i,s,o,"next",e)}function o(e){d(a,n,i,s,o,"throw",e)}s(void 0)}))}}var p=r("bc3a"),v=[{key:"title",label:"餐點"},{key:"number",label:"數量"},{key:"sum",label:"小計"}],h={name:"Order",data:function(){return{isLoading:!0,sheetSettings:{},orderSheet:null,ip:"",name:{valid:!1,validator:function(e){return e.valid=!!e.value&&e.value.length>0},value:""},phone:{valid:!1,validator:function(e){return e.valid=!!e.value&&new RegExp("^[0-9]*$").test(e.value)},value:""},orderDate:null,orderTime:{options:[{value:"0",label:"請選擇時間"}],valid:!1,validator:function(e){return e.valid=!!e.value&&0!=e.value},value:""},note:{value:"",display:""},menu:[],comfirmModal:!1,orderDetail:{data:[],count:0,sumPrice:0},fields:v}},components:{Loading:o["a"]},created:function(){this.getIp(),this.accessSpreadsheet()},methods:{getIp:function(){var e=this;return m(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,t.next=3,p.get("https://api.ipify.org?format=json").then((function(e){r.ip=e.data.ip}));case 3:case"end":return t.stop()}}),t)})))()},accessSpreadsheet:function(){var e=this;return m(regeneratorRuntime.mark((function t(){var r,n,i,a,o,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["getSettingDoc"])();case 2:return r=t.sent,t.next=5,Object(c["getOrderDoc"])();case 5:return n=t.sent,i=r.sheetsByTitle["表單列表"],t.next=9,i.getRows();case 9:a=t.sent,o=0;case 11:if(!(o<a.length)){t.next=29;break}if(d=a[o],!s()().isAfter(d.start_time)||!s()().isBefore(d.end_time)){t.next=26;break}return d.describe=d.describe.replaceAll("\n","<br>"),d.order_time=JSON.parse(d.order_time),d.groups=JSON.parse(d.groups),t.next=19,Object(l["getMenu"])(r,d.groups);case 19:return e.menu=t.sent,e.orderDate=s()(d.end_time).format("YYYY/MM/DD"),e.orderTime.options=e.orderTime.options.concat(d.order_time),e.sheetSettings=d,e.orderSheet=n.sheetsByTitle[d.sheetTitle],e.isLoading=!1,t.abrupt("break",29);case 26:o++,t.next=11;break;case 29:case"end":return t.stop()}}),t)})))()},getFileId:function(e){return e.match(/[-\w]{25,}/)},getOrderRow:function(){this.orderDetail.data=[],this.orderDetail.count=0,this.orderDetail.sumPrice=0;for(var e=0;e<this.menu.length;e++)for(var t=this.menu.slice(0),r=t[e],n=0;n<r.items.length;n++){var i=r.items.slice(0),a=i[n];if(a.number>0){var s=a.number*a.price;this.orderDetail.count+=a.number,this.orderDetail.sumPrice+=s;var o={type:r.type,key:a.key,title:a.title,number:a.number,price:a.price,sum:s};"set"==o.type&&(o.items=a.subItems),this.orderDetail.data.push(o)}}},showOrderDetail:function(){this.name.valid&&this.phone.valid&&this.orderTime.valid?(this.orderTime.display=this.orderDate+" "+this.orderTime.value,this.note.display=this.note.value.replaceAll("\n","<br>"),this.getOrderRow(),this.comfirmModal=!0):this.$scrollTo("#order-info")},send:function(){var e=this;return m(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLoading=!0,e.$cookies.set("phone",e.phone.value),t.next=4,e.orderSheet.addRow({timestamp:new Date,ip:e.ip,name:e.name.value,phone:e.phone.value,order_time:s()(e.orderTime.display).format(),note:e.note.display,detail:JSON.stringify(e.orderDetail.data),count:e.orderDetail.count,sum:e.orderDetail.sumPrice},{raw:!0});case 4:e.$router.push({path:"/history"});case 5:case"end":return t.stop()}}),t)})))()}}},f=h,g=r("2877"),b=Object(g["a"])(f,n,i,!1,null,null,null);t["default"]=b.exports}}]);
//# sourceMappingURL=chunk-3bcc9217.0db10293.js.map