{"version":3,"sources":["webpack:///./src/views/getFileId.js","webpack:///./src/views/getMenu.js","webpack:///./src/views/ItemList.js","webpack:///./src/views/order/Order.vue?32a2","webpack:///src/views/order/Order.vue","webpack:///./src/views/order/Order.vue?6465","webpack:///./src/views/order/Order.vue"],"names":["getFileId","url","match","module","exports","require","ItemList","getMenu","adminDoc","groups","showAll","_menu","groupIndex","_itemList","Object","hasOwnProperty","call","group","show","_type","_items","_images","sets","setIndex","set","_subItems","items","forEach","_item","_itemData","byKey","push","key","name","title","price","number","subItems","imgUrl","fileId","showImg","type","images","rows","itemListSheet","sheetsByTitle","getRows","itemListRows","index","length","item","id","render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","sheetSettings","domProps","describe","attrs","validator","model","value","callback","$$v","$set","expression","phone","orderTime","options","on","$event","_l","image","imgIndex","itemIndex","note","showOrderDetail","comfirmModal","scopedSlots","_u","fn","send","proxy","display","orderDetail","data","fields","count","sumPrice","isLoading","staticRenderFns","label","orderSheet","ip","valid","RegExp","test","orderDate","menu","components","Loading","created","getIp","accessSpreadsheet","methods","getOrderRow","sumItemPrice","sum","_data","replaceAll","$scrollTo","component"],"mappings":"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","file":"js/chunk-3bcc9217.0db10293.js","sourcesContent":["function getFileId(url) {\r\n    return url.match(/[-\\w]{25,}/);\r\n}\r\n\r\nmodule.exports = {\r\n    getFileId,\r\n}","const { getFileId } = require('./getFileId');\r\nconst { ItemList } = require('./ItemList');\r\n/**\r\n * \r\n * @param {object} adminDoc 管理文件\r\n * @param {Array} groups 菜單區塊\r\n * @param {Boolean} showAll 是否顯示全部\r\n * @returns \r\n */\r\nasync function getMenu(adminDoc, groups, showAll = false) {\r\n  let _menu = [];\r\n  let _itemList = await ItemList(adminDoc);\r\n\r\n  for (const groupIndex in groups) {\r\n    if (Object.hasOwnProperty.call(groups, groupIndex)) {\r\n      const group = groups[groupIndex];\r\n      //顯示與否\r\n      if (showAll || group.show) {\r\n        let _type = null;\r\n        let _items = [];\r\n        let _images = [];\r\n        //套餐\r\n        if (group.sets) {\r\n          _type = 'set';\r\n\r\n          for (const setIndex in group.sets) {\r\n            if (Object.hasOwnProperty.call(group.sets, setIndex)) {\r\n              const set = group.sets[setIndex];\r\n              \r\n              if (showAll || set.show) {\r\n                let _subItems = [];\r\n\r\n                set.items.forEach(_item => {\r\n                  let _itemData = _itemList.byKey[_item];\r\n                  \r\n                  _subItems.push({\r\n                    key: _item,\r\n                    name: _itemData.name\r\n                  });\r\n                });\r\n                _items.push({\r\n                  key: set.key,\r\n                  title: set.title,\r\n                  price: set.price,\r\n                  number: 0,\r\n                  subItems: _subItems\r\n                });\r\n                \r\n                if (set.imgUrl != null) {\r\n                  let fileId = getFileId(set.imgUrl);\r\n                  _images.push(fileId);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        //單點\r\n        if (group.items) {\r\n          _type = 'single';\r\n\r\n          group.items.forEach(_item => {\r\n            if (showAll || _item.show) {\r\n              let _itemData = _itemList.byKey[_item.key];\r\n\r\n              _items.push({\r\n                key: _item.key,\r\n                title: _itemData.name,\r\n                price: _item.price,\r\n                number: 0\r\n              });\r\n\r\n              if (_item.showImg) {\r\n                if (_itemData.url != null) {\r\n                  let fileId = getFileId(_itemData.url);\r\n                  _images.push(fileId);\r\n                }\r\n              }\r\n            }\r\n          });\r\n        }\r\n\r\n        _menu.push({\r\n          type: _type,\r\n          title: group.title,\r\n          items: _items,\r\n          images: _images\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  return _menu;\r\n}\r\n\r\nmodule.exports = {\r\n  getMenu\r\n}","async function ItemList(adminDoc) {\r\n    let _itemList = {\r\n        rows: [],\r\n        byKey: {}\r\n    };\r\n\r\n    const itemListSheet = adminDoc.sheetsByTitle['品項'];\r\n    const itemListRows = await itemListSheet.getRows();\r\n    //品項資料\r\n    for (let index = 0; index < itemListRows.length; index++) {\r\n        const item = itemListRows[index];\r\n        //品項\r\n        if (item.id) {\r\n            _itemList.rows.push(item);\r\n            _itemList.byKey[item.id] = item;\r\n        }\r\n    }\r\n\r\n    return _itemList;\r\n}\r\n\r\nmodule.exports ={\r\n    ItemList\r\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('CContainer',[_c('CCard',{staticClass:\"my-4\"},[_c('CCardHeader',[_c('h1',[_vm._v(_vm._s(_vm.sheetSettings.title))]),_c('p',{domProps:{\"innerHTML\":_vm._s(_vm.sheetSettings.describe)}})])],1),_c('CCard',{staticClass:\"my-4\",attrs:{\"id\":\"order-info\"}},[_c('CCardHeader',[_c('h4',[_vm._v(\"訂購人資訊\")])]),_c('CCardBody',[_c('CRow',[_c('CCol',{attrs:{\"sm\":\"12\"}},[_c('CInput',{attrs:{\"label\":\"姓名(必填)\",\"placeholder\":\"取餐人姓名\",\"invalid-feedback\":\"請填入姓名\",\"is-valid\":_vm.name.validator(_vm.name),\"size\":\"lg\"},model:{value:(_vm.name.value),callback:function ($$v) {_vm.$set(_vm.name, \"value\", $$v)},expression:\"name.value\"}})],1)],1),_c('CRow',[_c('CCol',{attrs:{\"sm\":\"12\"}},[_c('CInput',{attrs:{\"type\":\"number\",\"label\":\"電話(必填)\",\"placeholder\":\"09XX-XXXXXX\",\"invalid-feedback\":\"請填入電話\",\"is-valid\":_vm.phone.validator(_vm.phone),\"size\":\"lg\"},model:{value:(_vm.phone.value),callback:function ($$v) {_vm.$set(_vm.phone, \"value\", $$v)},expression:\"phone.value\"}})],1)],1),_c('CRow',[_c('CCol',{attrs:{\"sm\":\"4\"}},[_c('CSelect',{attrs:{\"value\":_vm.orderTime.value,\"label\":\"訂購時間(必填)\",\"options\":_vm.orderTime.options,\"invalid-feedback\":\"請選擇時間\",\"is-valid\":_vm.orderTime.validator(_vm.orderTime),\"size\":\"lg\"},on:{\"update:value\":function($event){return _vm.$set(_vm.orderTime, \"value\", $event)}}})],1)],1)],1)],1),_vm._l((_vm.menu),function(group,groupIndex){return _c('CCard',{key:'menu' + groupIndex,staticClass:\"my-4\"},[_c('CCardHeader',{staticClass:\"d-flex align-items-center\"},[_c('h4',[_vm._v(_vm._s(group.title))])]),_vm._l((group.images),function(image,imgIndex){return _c('CCardBody',{key:'img' + imgIndex,staticClass:\"border-bottom\"},[_c('CCol',{attrs:{\"lg\":\"6\"}},[_c('CImg',{attrs:{\"src\":'https://drive.google.com/uc?export=view&id=' + image,\"width\":\"100%\"}})],1)],1)}),_vm._l((group.items),function(item,itemIndex){return _c('CCardBody',{key:'item' + itemIndex,staticClass:\"border-bottom\"},[_c('b-row',[_c('b-col',{staticClass:\"d-flex align-items-center\"},[_c('h4',[_vm._v(_vm._s(item.title))]),_c('h3',{staticClass:\"ml-2\"},[_c('CBadge',{attrs:{\"shape\":\"pill\",\"color\":\"success\"}},[_vm._v(\"$\"+_vm._s(item.price))])],1)]),_c('b-col',{staticClass:\"d-flex justify-content-end\"},[_c('b-form-spinbutton',{attrs:{\"id\":\"sb-inline\",\"size\":\"lg\",\"min\":\"0\",\"max\":\"10\",\"inline\":\"\",\"variant\":\"warning\"},model:{value:(item.number),callback:function ($$v) {_vm.$set(item, \"number\", $$v)},expression:\"item.number\"}})],1)],1)],1)})],2)}),_c('CCard',{staticClass:\"my-4\"},[_c('CCardHeader',[_c('h4',[_vm._v(\"訂單備註\")])]),_c('CCardBody',[_c('CTextarea',{attrs:{\"placeholder\":\"請寫下備註\",\"size\":\"lg\"},model:{value:(_vm.note.value),callback:function ($$v) {_vm.$set(_vm.note, \"value\", $$v)},expression:\"note.value\"}})],1)],1),_c('CButton',{staticClass:\"my-1\",attrs:{\"size\":\"lg\",\"color\":\"warning\",\"block\":\"\"},on:{\"click\":_vm.showOrderDetail}},[_vm._v(\" 送出訂單 \")])],2),_c('CModal',{attrs:{\"title\":\"確認訂單\",\"show\":_vm.comfirmModal,\"color\":\"warning\",\"size\":\"sm\",\"closeOnBackdrop\":false},on:{\"update:show\":function($event){_vm.comfirmModal=$event}},scopedSlots:_vm._u([{key:\"footer\",fn:function(){return [_c('CButton',{attrs:{\"color\":\"danger\"},on:{\"click\":function($event){_vm.comfirmModal = false}}},[_vm._v(\"返回\")]),_c('CButton',{attrs:{\"color\":\"success\"},on:{\"click\":_vm.send}},[_vm._v(\"送出\")])]},proxy:true}])},[_c('div',[_vm._v(\"取餐時間：\"),_c('span',[_vm._v(_vm._s(_vm.orderTime.display))])]),_c('div',[_vm._v(\"訂購姓名：\"+_vm._s(_vm.name.value))]),_c('div',[_vm._v(\"聯絡電話：\"+_vm._s(_vm.phone.value))]),_c('hr'),_c('CDataTable',{attrs:{\"border\":\"\",\"items\":_vm.orderDetail.data,\"fields\":_vm.fields}}),_c('div',{staticClass:\"p-2 mb-2 bg-warning text-white text-center\"},[_vm._v(\"總計 \"),_c('span',[_vm._v(_vm._s(_vm.orderDetail.count))]),_vm._v(\" 樣菜 / 共 \"),_c('span',[_vm._v(\"$\"+_vm._s(_vm.orderDetail.sumPrice))])]),_c('hr'),_c('div',[_vm._v(\"備註：\")]),_c('h3',{domProps:{\"innerHTML\":_vm._s(_vm.note.display)}})],1),_c('Loading',{attrs:{\"isLoading\":_vm.isLoading}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <CContainer>\r\n      <CCard class=\"my-4\">\r\n        <CCardHeader>\r\n          <h1>{{ sheetSettings.title }}</h1>\r\n          <p v-html=\"sheetSettings.describe\"></p>\r\n        </CCardHeader>\r\n      </CCard>\r\n\r\n      <CCard class=\"my-4\" id=\"order-info\">\r\n        <CCardHeader>\r\n          <h4>訂購人資訊</h4>\r\n        </CCardHeader>\r\n        <CCardBody>\r\n          <CRow>\r\n            <CCol sm=\"12\">\r\n              <CInput \r\n                v-model=\"name.value\"\r\n                label=\"姓名(必填)\"\r\n                placeholder=\"取餐人姓名\"\r\n                invalid-feedback=\"請填入姓名\"\r\n                :is-valid=\"name.validator(name)\"\r\n                size=\"lg\"\r\n              />\r\n            </CCol>\r\n          </CRow>\r\n          <CRow>\r\n            <CCol sm=\"12\">\r\n              <CInput\r\n                type=\"number\"\r\n                v-model=\"phone.value\"\r\n                label=\"電話(必填)\"\r\n                placeholder=\"09XX-XXXXXX\"\r\n                invalid-feedback=\"請填入電話\"\r\n                :is-valid=\"phone.validator(phone)\"\r\n                size=\"lg\"\r\n              />\r\n            </CCol>\r\n          </CRow>\r\n          <CRow>\r\n            <CCol sm=\"4\">\r\n              <CSelect\r\n                :value.sync=\"orderTime.value\"\r\n                label=\"訂購時間(必填)\"\r\n                :options=\"orderTime.options\"\r\n                invalid-feedback=\"請選擇時間\"\r\n                :is-valid=\"orderTime.validator(orderTime)\"\r\n                size=\"lg\"\r\n              />\r\n            </CCol>\r\n          </CRow>\r\n        </CCardBody>\r\n      </CCard>\r\n\r\n      <CCard class=\"my-4\" v-for=\"(group, groupIndex) in menu\" :key=\"'menu' + groupIndex\">\r\n        <CCardHeader class=\"d-flex align-items-center\">\r\n          <h4>{{ group.title }}</h4>\r\n        </CCardHeader>\r\n        <CCardBody v-for=\"(image, imgIndex) in group.images\" :key=\"'img' + imgIndex\" class=\"border-bottom\">\r\n          <CCol lg=\"6\">\r\n            <CImg\r\n              :src=\"'https://drive.google.com/uc?export=view&id=' + image\"\r\n              width=\"100%\"\r\n            />\r\n          </CCol>\r\n        </CCardBody>\r\n        <CCardBody v-for=\"(item, itemIndex) in group.items\" :key=\"'item' + itemIndex\" class=\"border-bottom\">\r\n          <b-row>\r\n            <b-col class=\"d-flex align-items-center\">\r\n              <h4>{{ item.title }}</h4>\r\n              <h3 class=\"ml-2\"><CBadge shape=\"pill\" color=\"success\">${{ item.price }}</CBadge></h3>\r\n            </b-col>\r\n            <b-col class=\"d-flex justify-content-end\">\r\n              <b-form-spinbutton id=\"sb-inline\" v-model=\"item.number\" size=\"lg\" min=\"0\" max=\"10\" inline variant=\"warning\"></b-form-spinbutton>\r\n            </b-col>\r\n          </b-row>\r\n        </CCardBody>\r\n      </CCard>\r\n      \r\n      <CCard class=\"my-4\">\r\n        <CCardHeader>\r\n          <h4>訂單備註</h4>\r\n        </CCardHeader>\r\n        <CCardBody>\r\n          <CTextarea\r\n            v-model=\"note.value\"\r\n            placeholder=\"請寫下備註\"\r\n            size=\"lg\"\r\n          />\r\n        </CCardBody>\r\n      </CCard>\r\n      \r\n      <CButton @click=\"showOrderDetail\" size=\"lg\" color=\"warning\" block class=\"my-1\">\r\n        送出訂單\r\n      </CButton>\r\n    </CContainer>\r\n    <CModal\r\n      title=\"確認訂單\"\r\n      :show.sync=\"comfirmModal\"\r\n      color=\"warning\"\r\n      size=\"sm\"\r\n      :closeOnBackdrop=\"false\"\r\n    >\r\n      <div>取餐時間：<span>{{ orderTime.display }}</span></div>\r\n      <div>訂購姓名：{{ name.value }}</div>\r\n      <div>聯絡電話：{{ phone.value }}</div>\r\n      <hr>\r\n      \r\n      <CDataTable\r\n        border\r\n        :items=\"orderDetail.data\"\r\n        :fields=\"fields\"\r\n      >\r\n      </CDataTable>\r\n      <div class=\"p-2 mb-2 bg-warning text-white text-center\">總計 <span>{{ orderDetail.count }}</span> 樣菜 / 共 <span>${{ orderDetail.sumPrice }}</span></div>\r\n      <hr>\r\n      <div>備註：</div>\r\n      <h3 v-html=\"note.display\"></h3>\r\n      \r\n      <template #footer>\r\n        <CButton @click=\"comfirmModal = false\" color=\"danger\">返回</CButton>\r\n        <CButton @click=\"send\" color=\"success\">送出</CButton>\r\n      </template>\r\n    </CModal>\r\n\r\n    <Loading :isLoading=\"isLoading\"/>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport moment from 'moment'\r\nimport Loading from '@/views/Loading'\r\nimport { getMenu } from '@/views/getMenu';\r\nimport { getSettingDoc } from '@/gapi/getSettingDoc';\r\nimport { getOrderDoc } from '@/gapi/getOrderDoc';\r\nconst axios = require('axios');\r\nconst fields = [{\r\n  key: 'title',\r\n  label: '餐點',\r\n}, {\r\n  key: 'number',\r\n  label: '數量',\r\n}, {\r\n  key: 'sum',\r\n  label: '小計',\r\n}];\r\n\r\nexport default {\r\n  name: 'Order',\r\n  data () {\r\n    return {\r\n      isLoading: true,\r\n      sheetSettings: {},\r\n      orderSheet: null,\r\n      ip: '',\r\n      //姓名\r\n      name: {\r\n        valid: false,\r\n        validator: data => {\r\n          return data.valid = data.value ? data.value.length > 0 : false\r\n        },\r\n        value: ''\r\n      },\r\n      //電話\r\n      phone: {\r\n        valid: false,\r\n        validator: data => {\r\n          return data.valid = data.value ? new RegExp('^[0-9]*$').test(data.value) : false\r\n        },\r\n        value: ''\r\n      },\r\n      //取餐時間\r\n      orderDate: null,\r\n      orderTime: {\r\n        options: [{value: '0', label: '請選擇時間'}],\r\n        valid: false,\r\n        validator: data => {\r\n          return data.valid = data.value ? data.value != 0 : false\r\n        },\r\n        value: '',\r\n      },\r\n      //備註\r\n      note: {\r\n        value: '',\r\n        //顯示用\r\n        display: ''\r\n      },\r\n      //菜單\r\n      menu: [],\r\n      //確認訂單\r\n      comfirmModal: false,\r\n      //訂單統計\r\n      orderDetail: {\r\n        data: [],\r\n        count: 0,\r\n        sumPrice: 0\r\n      },\r\n      //標頭\r\n      fields\r\n    }\r\n  },\r\n  components: {\r\n    Loading,\r\n  },\r\n  created: function(){\r\n    this.getIp();\r\n    this.accessSpreadsheet();\r\n  },\r\n  methods: {\r\n    //取得ip\r\n    async getIp(){\r\n      const _app = this;\r\n\r\n      await axios.get('https://api.ipify.org?format=json').then(function (res) {\r\n        // handle success\r\n        _app.ip = res.data.ip;\r\n      });\r\n    },\r\n    //取得表單設定\r\n    async accessSpreadsheet() {\r\n      const adminDoc = await getSettingDoc();\r\n      const orderDoc = await getOrderDoc();\r\n      const formListSheet = adminDoc.sheetsByTitle['表單列表'];\r\n      const formListRows = await formListSheet.getRows();\r\n      //表單設定\r\n      for (let index = 0; index < formListRows.length; index++) {\r\n        const formRow = formListRows[index];\r\n        //現在的表單\r\n        if (moment().isAfter(formRow.start_time) && moment().isBefore(formRow.end_time)) {\r\n          formRow.describe = formRow.describe.replaceAll(\"\\n\", \"<br>\");\r\n          formRow.order_time = JSON.parse(formRow.order_time);\r\n          formRow.groups = JSON.parse(formRow.groups);\r\n          \r\n          this.menu = await getMenu(adminDoc, formRow.groups);\r\n          this.orderDate = moment(formRow.end_time).format('YYYY/MM/DD')\r\n          this.orderTime.options = this.orderTime.options.concat(formRow.order_time);\r\n          this.sheetSettings = formRow;\r\n          this.orderSheet = orderDoc.sheetsByTitle[formRow.sheetTitle];\r\n          //停止loading\r\n          this.isLoading = false;\r\n          break;\r\n        }\r\n      }\r\n    },\r\n    //取得檔案id\r\n    getFileId: function(url) {\r\n      return url.match(/[-\\w]{25,}/);\r\n    },\r\n    //取得訂單資訊\r\n    getOrderRow: function() {\r\n      this.orderDetail.data = [];\r\n      this.orderDetail.count = 0;\r\n      this.orderDetail.sumPrice = 0;\r\n\r\n      for (let groupIndex = 0; groupIndex < this.menu.length; groupIndex++) { \r\n        let _menu = this.menu.slice(0);\r\n        const group = _menu[groupIndex];\r\n        \r\n        for (let itemIndex = 0; itemIndex < group.items.length; itemIndex++) { \r\n          let _items = group.items.slice(0);\r\n          const _item = _items[itemIndex];\r\n          //有訂購\r\n          if (_item.number > 0) { \r\n            let sumItemPrice = _item.number * _item.price;\r\n            this.orderDetail.count += _item.number;\r\n            this.orderDetail.sumPrice += sumItemPrice;\r\n            let _data = {\r\n              type: group.type,\r\n              key: _item.key,\r\n              title: _item.title,\r\n              number: _item.number,\r\n              price: _item.price,\r\n              sum: sumItemPrice\r\n            }\r\n            if (_data.type == \"set\") {\r\n              _data.items = _item.subItems;\r\n            }\r\n            \r\n            this.orderDetail.data.push(_data);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    //確認訂單\r\n    showOrderDetail: function() {\r\n      if (!this.name.valid) {\r\n        this.$scrollTo(\"#order-info\");\r\n        return;\r\n      }\r\n      if (!this.phone.valid) {\r\n        this.$scrollTo(\"#order-info\");\r\n        return;\r\n      }\r\n      if (!this.orderTime.valid) {\r\n        this.$scrollTo(\"#order-info\");\r\n        return;\r\n      }\r\n      \r\n      this.orderTime.display = this.orderDate + \" \" + this.orderTime.value;\r\n      this.note.display = this.note.value.replaceAll(\"\\n\", '<br>');\r\n      this.getOrderRow();\r\n      this.comfirmModal = true;\r\n    },\r\n    async send(){\r\n      this.isLoading = true;\r\n      this.$cookies.set('phone',this.phone.value);\r\n      await this.orderSheet.addRow({\r\n        \"timestamp\": new Date(),\r\n        \"ip\": this.ip,\r\n        \"name\": this.name.value,\r\n        \"phone\": this.phone.value,\r\n        \"order_time\": moment(this.orderTime.display).format(),\r\n        \"note\": this.note.display,\r\n        \"detail\": JSON.stringify(this.orderDetail.data),\r\n        \"count\": this.orderDetail.count,\r\n        \"sum\": this.orderDetail.sumPrice,\r\n      }, {\r\n        raw: true\r\n      });\r\n\r\n      this.$router.push({ path: '/history' });\r\n    },\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Order.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Order.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Order.vue?vue&type=template&id=6710ec7b&\"\nimport script from \"./Order.vue?vue&type=script&lang=js&\"\nexport * from \"./Order.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}