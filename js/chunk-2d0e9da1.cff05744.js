(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e9da1"],{"8efd":function(e,t,s){"use strict";s.r(t);var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("b-form",{staticClass:"mb-4",attrs:{inline:""}},[s("label",{staticClass:"mr-sm-2"},[e._v("表單")]),s("b-form-select",{staticClass:"mb-2 mr-sm-2 mb-sm-0",attrs:{options:e.formOptions,size:"lg"},on:{change:e.selectForm},model:{value:e.formSelected,callback:function(t){e.formSelected=t},expression:"formSelected"}})],1),s("b-tabs",{attrs:{pills:"",card:""}},[s("b-tab",{attrs:{title:"全天",active:""}},[s("b-row",e._l(e.tableData.card.single,(function(t,n){return s("b-col",{key:"allday_single_"+n,attrs:{md:"3"}},[s("b-card",{staticClass:"text-center",attrs:{"no-body":""}},[s("div",[s("p",{staticClass:"text-muted"},[e._v(e._s(e.itemList.byKey[n]["name"]))]),s("h2",{staticClass:"mb-2"},[e._v(e._s(t.noon)+"/"+e._s(t.night))])])])],1)})),1),s("b-row",e._l(e.tableData.card.set,(function(t,n){return s("b-col",{key:"allday_set_"+n,attrs:{md:"3"}},[s("b-card",{staticClass:"text-center",attrs:{"no-body":""}},[s("div",[s("p",{staticClass:"text-muted"},[e._v(e._s(e.setList.byKey[n]["title"]))]),s("h2",{staticClass:"mb-2"},[e._v(e._s(t.noon)+"/"+e._s(t.night))])])])],1)})),1)],1),s("b-tab",{attrs:{title:"午"}},[s("b-table",{attrs:{border:"",hover:"","head-variant":"dark",items:e.tableData.noon,fields:e.orderTime.noon}})],1),s("b-tab",{attrs:{title:"晚"}},[s("b-table",{attrs:{border:"",hover:"","head-variant":"dark",items:e.tableData.night,fields:e.orderTime.night}})],1)],1),s("Loading",{attrs:{isLoading:e.isLoading}})],1)},a=[],r=s("c1df"),i=s.n(r),o=s("45d6"),l=s("cc0c"),m=s("31ac"),u=s("75b7");s("77ed");function c(e,t,s,n,a,r,i){try{var o=e[r](i),l=o.value}catch(m){return void s(m)}o.done?t(l):Promise.resolve(l).then(n,a)}function h(e){return function(){var t=this,s=arguments;return new Promise((function(n,a){var r=e.apply(t,s);function i(e){c(r,n,a,i,o,"next",e)}function o(e){c(r,n,a,i,o,"throw",e)}i(void 0)}))}}var d={name:"OrderAnalysis",data:function(){return{isLoading:!0,adminDoc:null,orderDoc:null,formListSheet:null,formListRows:{rows:[],byKey:{}},formSelected:null,formOptions:[],interval:null,orders:[],leftMenu:[""],tableColumns:{single:{},set:{}},tableData:{card:{single:{},set:{}},all:[],noon:[],night:[]},orderTime:{all:[],noon:[],night:[]},setList:{rows:[],byKey:{}},itemList:{rows:[],byKey:{}},menu:[],periodKey:["all","noon","night"]}},props:{editSheet:String},components:{Loading:o["a"]},created:function(){i.a.locale("zh-tw"),this.accessSpreadSheet()},methods:{accessSpreadSheet:function(){var e=this;return h(regeneratorRuntime.mark((function t(){var s,n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(m["getSettingDoc"])();case 2:return e.adminDoc=t.sent,t.next=5,Object(u["getOrderDoc"])();case 5:return e.orderDoc=t.sent,e.formListSheet=e.adminDoc.sheetsByTitle["表單列表"],t.next=9,e.formListSheet.getRows();case 9:return e.formListRows.rows=t.sent,s=e.adminDoc.sheetsByTitle["品項"],t.next=13,s.getRows();case 13:for(n=t.sent,a=0;a<n.length;a++)r=n[a],r.id&&(e.itemList.rows.push(r),e.itemList.byKey[r.id]=r);e.init(),e.getAnalysis();case 17:case"end":return t.stop()}}),t)})))()},init:function(){var e=this;return h(regeneratorRuntime.mark((function t(){var s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(e.formOptions=[],s=e.formListRows.rows.length-1;s>=0;s--)n=e.formListRows.rows[s],e.formListRows.byKey[n.sheetTitle]=n,n.order_time=JSON.parse(n.order_time),n.groups=JSON.parse(n.groups),e.formOptions.push({text:n.title,value:n.sheetTitle}),null==e.formSelected&&(null!=e.editSheet?n.sheetTitle==e.editSheet&&e.getForm(n):i()().isAfter(n.start_time)&&i()().isBefore(n.end_time)&&e.getForm(n));null==e.formSelected&&e.getForm(e.formListRows.rows[e.formListRows.rows.length-1]);case 3:case"end":return t.stop()}}),t)})))()},selectForm:function(){var e=this;return h(regeneratorRuntime.mark((function t(){var s,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.isLoading=!0,s=0;case 2:if(!(s<e.formListRows.rows.length)){t.next=10;break}if(n=e.formListRows.rows[s],e.formSelected!=n.sheetTitle){t.next=7;break}return e.getForm(n).then((function(){})),t.abrupt("break",10);case 7:s++,t.next=2;break;case 10:case"end":return t.stop()}}),t)})))()},getForm:function(e){var t=this;return h(regeneratorRuntime.mark((function s(){var n,a,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.formSelected=e.sheetTitle,s.next=3,Object(l["getMenu"])(t.adminDoc,e.groups,!0);case 3:return t.menu=s.sent,n=t.orderDoc.sheetsByTitle[t.formSelected],s.next=7,n.getRows();case 7:for(t.orders=s.sent,t.orderTime={all:[{key:"menu",label:"品項"}],noon:[{key:"menu",label:"品項"}],night:[{key:"menu",label:"品項"}]},a=0;a<e.order_time.length;a++)r=e.order_time[a],i()("2000-01-01 "+r).isBefore("2000-01-01 14:00")?t.orderTime.noon.push(r):t.orderTime.night.push(r),t.orderTime.all.push(r);t.orderTime.noon.push({key:"total",label:"總"}),t.orderTime.night.push({key:"total",label:"總"}),t.orderTime.all.push({key:"total",label:"總"}),t.getAnalysis();case 14:case"end":return s.stop()}}),s)})))()},getAnalysis:function(){var e=this;this.tableData={card:{single:{},set:{}},all:[],noon:[],night:[]},this.tableColumns={single:{},set:{}},this.leftMenu=[""];for(var t=0;t<this.menu.length;t++){var s=this.menu[t];if("set"==s.type)for(var n=0;n<s.items.length;n++){var a=s.items[n];this.setList.rows.push(a),this.setList.byKey[a.key]=a,this.tableColumns.set[a.key]||(this.tableColumns.set[a.key]={total:{is_take:0,not_take:0}});for(var r=0;r<a.subItems.length;r++){var o=a.subItems[r];this.tableColumns.single[o.key]||(this.tableColumns.single[o.key]={total:{is_take:0,not_take:0}});for(var l=0;l<this.orderTime.all.length;l++){var m=this.orderTime.all[l];"menu"!=m&&(this.tableColumns.set[a.key][m]||(this.tableColumns.set[a.key][m]={is_take:0,not_take:0}),this.tableColumns.single[o.key][m]||(this.tableColumns.single[o.key][m]={is_take:0,not_take:0}))}this.leftMenu.includes(o.key)||this.leftMenu.push(o.key)}}else for(var u=0;u<s.items.length;u++){var c=s.items[u];this.tableColumns.single[c.key]||(this.tableColumns.single[c.key]={total:{is_take:0,not_take:0}});for(var h=0;h<this.orderTime.all.length;h++){var d=this.orderTime.all[h];"menu"==d||this.tableColumns.single[c.key][d]||(this.tableColumns.single[c.key][d]={is_take:0,not_take:0})}this.leftMenu.includes(c.key)||this.leftMenu.push(c.key)}}for(var b=0;b<this.orders.length;b++)for(var f=this.orders[b],k=i()(f.order_time).format("HH:mm"),g=JSON.parse(f.detail),y=0;y<g.length;y++){var _=g[y];if("set"==_.type){""==f.take_time?(this.tableColumns.set[_.key][k].not_take+=_.number,this.tableColumns.set[_.key]["total"].not_take+=_.number):(this.tableColumns.set[_.key][k].is_take+=_.number,this.tableColumns.set[_.key]["total"].is_take+=_.number);for(var v=0;v<_.items.length;v++){var p=_.items[v];""==f.take_time?(this.tableColumns.single[p.key][k].not_take+=_.number,this.tableColumns.single[p.key]["total"].not_take+=_.number):(this.tableColumns.single[p.key][k].is_take+=_.number,this.tableColumns.single[p.key]["total"].is_take+=_.number)}}else"single"==_.type&&(""==f.take_time?(this.tableColumns.single[_.key][k].not_take+=_.number,this.tableColumns.single[_.key]["total"].not_take+=_.number):(this.tableColumns.single[_.key][k].is_take+=_.number,this.tableColumns.single[_.key]["total"].is_take+=_.number))}for(var w=function(t){var s=e.leftMenu[t];if(""!=s){var n=e.itemList.byKey[s]["name"];e.tableData.card.single[s]={noon:0,night:0};var a={},r={};e.periodKey.forEach((function(t){a[t]={menu:n},r[t]={is_take:0,not_take:0};for(var i=0;i<e.orderTime[t].length;i++){var o=e.orderTime[t][i],l=e.tableColumns.single[s][o];if("menu"!=o){var m=l.not_take+l.is_take;a[t][o]=l.not_take+" / "+m,r[t].not_take+=l.not_take,r[t].is_take+=l.is_take,"all"!=t&&(e.tableData.card.single[s][t]+=m)}}a[t]["total"]=r[t].not_take+" / "+(r[t].not_take+r[t].is_take),e.tableData[t].push(a[t])}))}},C=0;C<this.leftMenu.length;C++)w(C);var L=function(t){if(Object.hasOwnProperty.call(e.tableColumns.set,t)){var s=e.tableColumns.set[t],n=e.setList.byKey[t]["title"];e.tableData.card.set[t]={noon:0,night:0};var a={},r={};e.periodKey.forEach((function(i){a[i]={menu:n},r[i]={is_take:0,not_take:0};for(var o=0;o<e.orderTime[i].length;o++){var l=e.orderTime[i][o],m=s[l];if("menu"!=l){var u=m.not_take+m.is_take;a[i][l]=m.not_take+" / "+u,r[i].not_take+=m.not_take,r[i].is_take+=m.is_take,"all"!=i&&(e.tableData.card.set[t][i]+=u)}}a[i]["total"]=r[i].not_take+" / "+(r[i].not_take+r[i].is_take),e.tableData[i].push(a[i])}))}};for(var T in this.tableColumns.set)L(T);this.isLoading=!1},autoUpdate:function(){var e=this;this.interval=setInterval((function(){e.selectForm(),console.log(i()().format()+" loading complete")}),5e3)},stopUpdate:function(){clearInterval(this.interval)}}},b=d,f=s("2877"),k=Object(f["a"])(b,n,a,!1,null,null,null);t["default"]=k.exports}}]);
//# sourceMappingURL=chunk-2d0e9da1.cff05744.js.map